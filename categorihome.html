<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Galai - Best Honey in Your City</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <link href="img/favicon.ico" rel="icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style>
        /* Style pour le bouton sélectionné */
        .selected {
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
            border-color: #333; /* Ajouter une bordure pour un effet visuel */
        }

        .sold-out {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container wow fadeInUp" data-wow-delay="0.1s" id="categories-container">
        <!-- Contenu dynamique injecté ici -->
    </div>

    <!-- Include Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                function createImageContainer(isEven) {
                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('container', 'wow', 'fadeInUp');
                    imageContainer.setAttribute('data-wow-delay', '0.1s');

                    const imageRow = document.createElement('div');
                    imageRow.classList.add('row');
                    imageRow.setAttribute('id', 'image');

                    const imageDiv = document.createElement('div');
                    imageDiv.innerHTML = isEven
                        ? `<img class="rounded" width="100%" height="auto" src="img/Dans le passé, le présent et le futur, GALAI MIEL vous offre les meilleurs types/1.png" alt="">`
                        : `<img class="rounded" width="100%" height="auto" src="img/Dans le passé, le présent et le futur, GALAI MIEL vous offre les meilleurs types/2.png" alt="">`;

                    imageRow.appendChild(imageDiv);
                    imageContainer.appendChild(imageRow);
                    
                    return imageContainer;
                }
                const response = await axios.get('http://localhost:8088/categorie/getAll/prodsWithThumb');
                const categories = response.data;
                
                if (Array.isArray(categories)) {
                    const categoriesContainer = document.getElementById('categories-container');
    
                    categories.forEach((category, index) => {

                        const isEven = (index % 2 === 0);

                        const imageContainer = createImageContainer(isEven);
                        categoriesContainer.appendChild(imageContainer);

                        const categoryDiv = document.createElement('div');
                        categoryDiv.classList.add('row', 'category-container');
                        
                        const categoryImageDiv = document.createElement('div');
                        categoryImageDiv.classList.add('productsImg', 'col-sm-3');
                        categoryImageDiv.innerHTML = `<img src="data:image/jpeg;base64,${category.photo}" alt="${category.nom}">`;
                        categoryDiv.appendChild(categoryImageDiv);
    
                        const productsContainer = document.createElement('div');
                        productsContainer.classList.add('col-sm-9', 'row', 'ml');
                        
                        const chevronLeftDiv = document.createElement('div');
                        chevronLeftDiv.classList.add('chevronLeft', 'col-sm-1');
                        chevronLeftDiv.innerHTML = `<i class="bi bi-chevron-left"></i>`;
                        productsContainer.appendChild(chevronLeftDiv);
    
                        const productsWrapper = document.createElement('div');
                        productsWrapper.classList.add('products', 'table-responsive', 'col-sm-10');
                        
                        category.produits.forEach(produit => {
                            const productHtml = `
                            <div class="product-item-w" style="margin-bottom: 0;">
                                <div class="prodImage">
                                    <img src="data:image/jpeg;base64,${produit.thumbnail}" class="pI" alt="${produit.nom}" style="width: 100%; height: auto;">
                                </div>
                                <div class="prodDetails" style="margin-top: 0; padding-top: 0; text-align:center;"><br>
                                    <h5 class="card-title">${produit.nom}</h5>
                                    <p class="selected-price" dir="rtl"></p>                                     
                                    ${produit.prixList.map(prix => `
                                        <button class="btn btn-outline-dark btn-sm grammage" 
                                            data-price="${prix.prix}" 
                                            data-remise="${prix.remise}" 
                                            data-qtt="${prix.qtt}">
                                            ${prix.grammage}g
                                        </button>`).join('')}
                                </div>
                            </div>`;
                            productsWrapper.innerHTML += productHtml;
                        });
    
                        productsContainer.appendChild(productsWrapper);
    
                        const chevronRightDiv = document.createElement('div');
                        chevronRightDiv.classList.add('chevronRight', 'col-sm-1');
                        chevronRightDiv.innerHTML = `<i class="bi bi-chevron-right"></i>`;
                        productsContainer.appendChild(chevronRightDiv);
    
                        categoryDiv.appendChild(productsContainer);
                        categoriesContainer.appendChild(categoryDiv);
                    });
    
                    function selectMinimumPrice(productContainer) {
                        const buttons = productContainer.querySelectorAll('.grammage');
                        let minPriceButton = buttons[0];
                        buttons.forEach(button => {
                            const price = parseFloat(button.getAttribute('data-price'));
                            const minPrice = parseFloat(minPriceButton.getAttribute('data-price'));
                            if (price < minPrice) {
                                minPriceButton = button;
                            }
                        });
    
                        minPriceButton.classList.add('selected');
    
                        const price = parseFloat(minPriceButton.getAttribute('data-price'));
                        const remise = parseFloat(minPriceButton.getAttribute('data-remise'));
                        const qtt = parseInt(minPriceButton.getAttribute('data-qtt'));
                        const discountedPrice = price - (price * (remise / 100));
    
                        const priceDisplay = minPriceButton.closest('.prodDetails').querySelector('.selected-price');
                        if (qtt === 0) {
                            priceDisplay.innerHTML = `<p class="sold-out">Solde Out</p>`;
                        } else {
                            if (remise === 0) {
                                priceDisplay.innerHTML = `<p style="color: black; font-size: medium;">À <span style="color: black;font-weight: bold;">${price}DT</span></p>`;
                            } else {
                                priceDisplay.innerHTML = `<p style="color: black; font-size: medium;">De <span style="color: grey; text-decoration: line-through;">${price}DT</span> à <span style="color: black;font-weight: bold;">${discountedPrice}DT</span></p>`;
                            }
                            priceDisplay.style.display = 'block';
                        }
                    }
    
                    const allProductContainers = categoriesContainer.querySelectorAll('.product-item-w');
                    allProductContainers.forEach(productContainer => {
                        selectMinimumPrice(productContainer);
                    });
    
                    categoriesContainer.addEventListener('click', function(event) {
                        if (event.target.classList.contains('grammage')) {
                            const allButtons = categoriesContainer.querySelectorAll('.grammage');
                            allButtons.forEach(button => button.classList.remove('selected'));
    
                            event.target.classList.add('selected');
    
                            const price = parseFloat(event.target.getAttribute('data-price'));
                            const remise = parseFloat(event.target.getAttribute('data-remise'));
                            const qtt = parseInt(event.target.getAttribute('data-qtt'));
                            const discountedPrice = price - (price * (remise / 100));
    
                            const priceDisplay = event.target.closest('.prodDetails').querySelector('.selected-price');
                            if (qtt === 0) {
                                priceDisplay.innerHTML = `<p class="sold-out">Solde Out</p>`;
                            } else {
                                if (remise === 0) {
                                    priceDisplay.innerHTML = `<p style="color: black; font-size: medium;">À <span style="color: black;font-weight: bold;">${price}DT</span></p>`;
                                } else {
                                    priceDisplay.innerHTML = `<p style="color: black; font-size: medium;">De <span style="color: grey; text-decoration: line-through;">${price}DT</span> à <span style="color: black;font-weight: bold;">${discountedPrice}DT</span></p>`;
                                }
                                priceDisplay.style.display = 'block';
                            }
                        }
                    });
                } else {
                    console.error('Expected an array of categories but got:', categories);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });
    </script>
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
